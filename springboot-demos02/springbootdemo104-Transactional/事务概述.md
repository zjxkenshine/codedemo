# 1.事务概述
## 1.1 事务特性ACID
- 原子性（Atomicity）：事务是一个不可分割的工作单位，事务中的操作 要么都发生，要么都不发生
- 一致性（Consistency）：一个事务中，事务前后数据的完整性必须保持一致
- 隔离性（Isolation）：多个用户并发访问数据库时， 一个用户的 事务不能被其它用户的事务所干扰，多个并发事务之间数据要相互隔离
- 持久性（Durability）：持久性是指一个事务一旦被提交，它对数据库中数据的改变 就是永久性的，接下来即使数据库发生故障也不应该对其有任何影响

## 1.2 事务的三种并发访问问题
1. 脏读：B事务读取到了A事务尚未提交的数据 
   - 要求B事务要读取A事务提交的数据
2. 不可重复读：一个事务中两次读取的数据的内容不一致
   - 要求的是一个事务中多次读取时数据是一致的
3. 幻读/虚读：一个事务中两次读取的数据的数量不一致
   - 要求在一个事务多次读取的数据的数量是一致的

## 1.3 事务的隔离级别
1. `read uncommitted`: 读取尚未提交的数据
2. `read committed`：读取已经提交的数据 ：可以解决脏读
    - oracle默认的
3. `repeatable read`：重读读取：可以解决脏读和不可重复读
    - mysql innodb默认的,`select @@tx_isolation`查看,MyISAM不支持事务
4. `serializable`：可以解决脏读，不可重复读和虚读，相当于锁表
    
隔离级别性能：
- `read uncommitted>read committed>repeatable read>serialazable`

安全性：
- `read uncommitted<read committed<repeatable read<serialazable`

# 2.Spring中的事务 @Transactional
1. Spring的默认的事务规则是遇到运行异常（RuntimeException及其子类）和程序错误（Error）才会进行事务回滚,可以在`@Transactional`注解里使用`rollbackFor`属性明确指定异常
    - `@Transactional(rollbackFor = Exception.class)`
2. 在业务层手工捕捉并处理了异常,则事务不会生效，建议统一在Controller层处理异常
3. 多个事务管理器需要用value指定
    - `@Transactional(value="指定manager的BeanId",rollbackfor=Exception.class)`
4. TransactionTemplate类：用于操作更细粒度的编程式事务
    
# 3.Spring事务失效八大原因
1. 数据库引擎不支持事务: MyISAM 引擎是不支持事务操作的
2. 没有被Spring管理:
3. 方法不是 public 的
4. 自身调用问题：嵌套事务，内部事务失效
5. 数据源没有配置事务管理器
6. 不支持事务：Propagation.NOT_SUPPORTED
7. 异常被吃了
8. 异常类型错误



