# 1.JMH概述
- JMH即Java Microbenchmark Harness，是Java用来做基准测试的一个工具，该工具由OpenJDK提供并维护，测试结果可信度高
- 可以直接用在需要进行基准测试的项目中，以单元测试方式使用，也可以通过IDEA插件方式使用

# 2.基准测试
1. 定义
    - 通过设计合理的测试方法，选用合适的测试工具和被测系统，实现对**某个特定目标场景**的某项性能指标进行**定量**的和可对比的测试
2. 基准测试特性
    - 可重复性、可观测性、可展示性、真实性、可执行性
3. 基准测试意义：
    - 为容量规划确定系统和应用程序的极限
    - 为配置测试的参数和配置选项提供参考依据
    - 为验收测试确定系统是否具备自己所宣称的能力
    - 为性能基线的建立提供长期的数据统计来源以及比较基准
4. 原则：
    - 测试策略：稳定且连续的工作负载，多次运行，看测试结果数据的正态分布趋势，尽量取平均值
    - 数据统计：真实环境下测试数据的平均值、峰值各是多少，取值的维度
    - 差异风险：明确存在哪些风险，风险对测试结果的影响，是否忽略
    - 特殊情况：有哪些特殊情况，是否有对应的解决方案（比如支付场景中的支付服务调用，是否采用挡板等）
5. 需要考虑的因素：
    - 交易配比，突发性的读写操作(浪涌测试)，系统配置，测试时长，结果展示类型，成功/失败占比，是否可重现，是否可对比
6. 简单可行的方法：阶梯式加压测试
7. 基准测试重点：统计分析
    - 选择合适的测试工具，设定合理的测试方法以及需要确认的系统性能指标
    - 选择不同的测试工具，对测试结果进行对比，选择稳定且能反应系统真是性能表现的结果
    - 多次执行测试，收集大量的测试数据集和指标
    - 从不同维度解读分析数据，生成报告

# 3.JMH注解方式
- 在运行时，注解配置被用于解析生成BenchmarkListEntry配置类实例
- 一个方法对应一个@Benchmark注解，一个@Benchmark注解对应一个基准测试方法
- 各注解作用：
    - `@Benchmark`：声明一个public方法为基准测试方法
    - `@BenchmarkMode`：指定测试维度（测试模式）
    - `@Measurement`：重复测试
        - iterations：测量次数；
        - time与timeUnit：每次测量的持续时间，timeUnit指定时间单位
    - `@Warmup`：配置预热参数
        - iterations：预热次数；
        - time与timeUnit：每次预热的持续时间，timeUnit指定时间单位
    - `@OutputTimeUnit`：指定输出的方法执行耗时的单位
    - `@Fork`：指定fork出多少个子进程来执行同一基准测试方法
    - `@Threads`：指定使用多少个线程来执行基准测试方法，如果使用@Threads指定线程数为2，那么每次测量都会创建两个线程来执行基准测试方法
    - `@Param`：使用@Param注解可指定基准方法执行参数，@Param注解只能指定String类型的值，可以是一个数组，参数值将在运行期间按给定顺序遍历
    - `@Setup`：方法注解，会在执行 benchmark 之前被执行，正如其名，主要用于初始化。
    - `@TearDown`：方法注解，与@Setup 相对的，会在所有 benchmark 执行结束以后执行，主要用于资源的回收等。
- 公共注解：可以将除`@Benchmark`注解外的其它注解都声明到类上
    - `@State`注解指定字段的共享域